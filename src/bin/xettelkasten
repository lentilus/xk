#!/usr/bin/env bash

set -e # exit on any non-0 exiting command

# export all variables after this
set -o allexport

BASE_DIR="$(realpath "$(dirname "$0")")"
BIN_DIR="$BASE_DIR"
LIB_DIR="${BASE_DIR}/../lib/xk"
ETC_DIR="${BASE_DIR}/../etc/xk"
SHARE_DIR="${BASE_DIR}/../share/xk"
CONFIG_DIR="${XDG_CONFIG_HOME:-${HOME}/.config/xk}"

source "$LIB_DIR/default_config"
source "$CONFIG_DIR/config"
source "$LIB_DIR/utils"

set +o allexport

[[ $1 == "init" ]] || check_kasten

case "$1" in
    ref)
        shift
        "$LIB_DIR/ref" "$@"
        ;;
    tag)
        shift
        "$LIB_DIR/tag" "$@"
        ;;
    git)
        shift
        "$LIB_DIR/git" "$@"
        ;;
    script)
        shift
        "$LIB_DIR/script" "$@"
        ;;
    *)
        "$LIB_DIR/zettel" "$@"
        ;;
esac
